# Инструкция по установке функционала запуска планировщиков из интерфейса оператора

До того как нечнете, проверьте что у вас есть класс "Справочник" с кодом "catalogs", а в нем есть строковый атрибут "Код" с кодом "code". Если нет - создайте. 
Все скрипты находятся в пакете ru.kazantsev.nsd.scripts.eventActions.startSchedulerFromUserInterface.

1. Создайте тип "Задача планировщика" с кодом "scheduler"  в классе "Справчник" (код класса "catalogs"), в котором будет
   хранится информация о планировщиках.
   Код созданного типа (полный, с классом) должен быть указан в параметре SCHEDULER_OBJECT_HOLDER_METACODE скрипта
   schedulerDescriptionCalculation.
2. Создайте строковый атрибут с названием "Код типа" и булевый "Задача запланирована" атрибут в ранее добавленном типе.
   В примере у атриботов испольщуются коды "cstring" и "cBool1" соответственно, но вы можете указать свои.
   Код строкового атрибута должнен быть указан в параметре TYPE_ATTR_CODE, а код логического атрибута должен быть
   указана в параметре IS_PLANNED_ATTR_CODE скрипта schedulerDescriptionCalculation.
3. Выведите список комментарией на карточке добавленного типа. Остальное на карточке по вашему вкусу.
4. Создайте новый ДПС с названием и кодом
   Параметры ДПС:

- Название: "Запуск планировщика из пользовательского интерфейса"
- Код: "startSchedulerFromUserInterface"
- Объекты: Компания
- Событие: пользовательское событие
- Действие: Скрипт
- Выполняется синхронно: да
  В качестве скрипта укажите содержимое скрипта startSchedulerFromUserInterface.

5. В созданном ДПС создайте параметры:

| Название                               | Код         | Тип                                                         | Обязательный | Скрипты                                                                           | Прочие особенности                          |
|----------------------------------------|-------------|-------------------------------------------------------------|--------------|-----------------------------------------------------------------------------------|---------------------------------------------|
| Тип задачи планировщика                | types       | Набор элементов произвольного справочника                   | нет          | Скрипт schedulerTypeCalculation для вычисления элементов справочника              | -                                           |
| Показывать только выполняющиеся задачи | onlyPlanned | Логический                                                  | нет          | -                                                                                 | -                                           |
| Задача планировщика                    | task        | Ссылка на бизнес-объект, ссылается на ранее добавленный тип | да           | Скрипт schedulerTasksFiltration для фильтрации                                    | -                                           |
| Описание задачи                        | desc        | Текст в формате RTF                                         | нет          | Скрипт schedulerDescriptionCalculation для вычисления значения при редактировании | Нередактируемый, скрывать название атрибута |

6. Выведите список объектов ранее созданного типа где то на карточке компании, добавьте в шапку списка кнопку для вызова ранее добалвенного ДПС (не забудьте включить).
7. Готово! 

## Дополнителньые настройки
Если вы хотите ограничить по типам запускаемые планировщики (допустим разрешить запускать только почтовые планировщики и скриптовые), 
вам необходимо в скриптах schedulerTasksFiltration  и schedulerTypeCalculation указать в параметре ONLY_TYPES коды разрешенных типов задач планировищика.
Перечень типов задач и их кодов можно найти в параметре TASK_TYPES скрипта schedulerTypeCalculation.